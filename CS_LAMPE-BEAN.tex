\documentclass{article}\usepackage[]{graphicx}\usepackage[]{color}
%% maxwidth is the original width if it is less than linewidth
%% otherwise use linewidth (to make sure the graphics do not exceed the margin)
\makeatletter
\def\maxwidth{ %
  \ifdim\Gin@nat@width>\linewidth
    \linewidth
  \else
    \Gin@nat@width
  \fi
}
\makeatother

\definecolor{fgcolor}{rgb}{0.345, 0.345, 0.345}
\newcommand{\hlnum}[1]{\textcolor[rgb]{0.686,0.059,0.569}{#1}}%
\newcommand{\hlstr}[1]{\textcolor[rgb]{0.192,0.494,0.8}{#1}}%
\newcommand{\hlcom}[1]{\textcolor[rgb]{0.678,0.584,0.686}{\textit{#1}}}%
\newcommand{\hlopt}[1]{\textcolor[rgb]{0,0,0}{#1}}%
\newcommand{\hlstd}[1]{\textcolor[rgb]{0.345,0.345,0.345}{#1}}%
\newcommand{\hlkwa}[1]{\textcolor[rgb]{0.161,0.373,0.58}{\textbf{#1}}}%
\newcommand{\hlkwb}[1]{\textcolor[rgb]{0.69,0.353,0.396}{#1}}%
\newcommand{\hlkwc}[1]{\textcolor[rgb]{0.333,0.667,0.333}{#1}}%
\newcommand{\hlkwd}[1]{\textcolor[rgb]{0.737,0.353,0.396}{\textbf{#1}}}%

\usepackage{framed}
\makeatletter
\newenvironment{kframe}{%
 \def\at@end@of@kframe{}%
 \ifinner\ifhmode%
  \def\at@end@of@kframe{\end{minipage}}%
  \begin{minipage}{\columnwidth}%
 \fi\fi%
 \def\FrameCommand##1{\hskip\@totalleftmargin \hskip-\fboxsep
 \colorbox{shadecolor}{##1}\hskip-\fboxsep
     % There is no \\@totalrightmargin, so:
     \hskip-\linewidth \hskip-\@totalleftmargin \hskip\columnwidth}%
 \MakeFramed {\advance\hsize-\width
   \@totalleftmargin\z@ \linewidth\hsize
   \@setminipage}}%
 {\par\unskip\endMakeFramed%
 \at@end@of@kframe}
\makeatother

\definecolor{shadecolor}{rgb}{.97, .97, .97}
\definecolor{messagecolor}{rgb}{0, 0, 0}
\definecolor{warningcolor}{rgb}{1, 0, 1}
\definecolor{errorcolor}{rgb}{1, 0, 0}
\newenvironment{knitrout}{}{} % an empty environment to be redefined in TeX

\usepackage{alltt}

\usepackage[margin = .5 in]{geometry}
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\begin{document}

\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}


{\ttfamily\noindent\color{warningcolor}{\#\# Warning: package 'pracma' was built under R version 3.1.1}}

{\ttfamily\noindent\itshape\color{messagecolor}{\#\# Loading required package: wavethresh\\\#\# Loading required package: MASS\\\#\# WaveThresh: R wavelet software, release 4.6.6, installed\\\#\# \\\#\# Copyright Guy Nason and others 1993-2013\\\#\# \\\#\# Note: nlevels has been renamed to nlevelsWT\\\#\# \\\#\# Loading required package: adlift\\\#\# Loading required package: EbayesThresh\\\#\# \\\#\#\ \ **********************************************\\\#\#\ \ adlift: a package to perform wavelet lifting schemes\\\#\# \\\#\#\ \ --- Written by Matt Nunes and Marina Knight ---\\\#\#\ \ \ \ Current package version:\ \ 1.3-2\ \ ( 01/11/2012 ) \\\#\# \\\#\#\ \ \ \ \ \ \ \ \ \ \ \ \ \ -+ packaged by MAN +-\ \ \ \ \ \ \ \ \ \  \\\#\#\ \ **********************************************\\\#\#\ \ \\\#\#\ \ adlift 1.3-2 loaded\\\#\# \\\#\# \\\#\# Attaching package: 'adlift'\\\#\# \\\#\# The following object is masked from 'package:EbayesThresh':\\\#\# \\\#\#\ \ \ \  postmean.cauchy\\\#\# \\\#\# \\\#\#\ \ **********************************************\\\#\#\ \ binhf: Haar-Fisz functions for binomial data\\\#\# \\\#\#\ \ --- Written by Matt Nunes ---\\\#\#\ \ \ \ Current package version:\ \ 1.0-1\ \ ( 24/04/2014 ) \\\#\# \\\#\#\ \ \\\#\#\ \ **********************************************\\\#\#\ \ \\\#\#\ \ binhf 1.0-1 loaded\\\#\# \\\#\# \\\#\# Attaching package: 'binhf'\\\#\# \\\#\# The following objects are masked from 'package:EbayesThresh':\\\#\# \\\#\#\ \ \ \  ebayesthresh.wavelet.wd, negloglik.laplace, wandafromx\\\#\# \\\#\# The following object is masked from 'package:wavethresh':\\\#\# \\\#\#\ \ \ \  madmad\\\#\# \\\#\# The following object is masked from 'package:base':\\\#\# \\\#\#\ \ \ \  norm\\\#\# \\\#\# \\\#\# Attaching package: 'deSolve'\\\#\# \\\#\# The following object is masked from 'package:pracma':\\\#\# \\\#\#\ \ \ \  rk4\\\#\# \\\#\# Loading required package: rootSolve\\\#\# \\\#\# Attaching package: 'rootSolve'\\\#\# \\\#\# The following objects are masked from 'package:pracma':\\\#\# \\\#\#\ \ \ \  gradient, hessian\\\#\# \\\#\# Loading required package: coda\\\#\# Loading required package: lattice\\\#\# \\\#\# Attaching package: 'FME'\\\#\# \\\#\# The following object is masked from 'package:pracma':\\\#\# \\\#\#\ \ \ \  Norm\\\#\# \\\#\# Loading required package: timeDate\\\#\# Loading required package: timeSeries\\\#\# \\\#\# Attaching package: 'fBasics'\\\#\# \\\#\# The following object is masked from 'package:deSolve':\\\#\# \\\#\#\ \ \ \  rk\\\#\# \\\#\# The following object is masked from 'package:binhf':\\\#\# \\\#\#\ \ \ \  norm\\\#\# \\\#\# The following objects are masked from 'package:pracma':\\\#\# \\\#\#\ \ \ \  akimaInterp, inv, kron, pascal\\\#\# \\\#\# The following object is masked from 'package:base':\\\#\# \\\#\#\ \ \ \  norm}}\begin{verbatim}
##  chr [1:18] "/Users/Lampe/GrantNo456417/MatParameterFitting/CompiledTestData/C-S_Database/CSV_M_SC/12OC891M.csv" ...
## NULL
## [1] "CHECK TEST IMPORT #:" "18"                  
##      ITEST ICASE TIME [DAY] S.A.MIN S.A.MAX S.A.AVG S.L.MIN S.L.MAX
## 1  12OC891     2     33.751  -3.796  -3.579  -3.702  -3.293 -3.2041
## 2    DCCS1     2      6.196  -6.524  -4.091  -4.961  -1.025 -0.9747
## 3   DCCS10     2     46.949  -9.115  -8.820  -9.008  -5.007 -4.9252
## 4   DCCS15     2      5.924  -5.232  -4.968  -5.010  -1.020 -0.9876
## 5    DCCS3     2     37.096  -6.009  -5.866  -5.980  -2.006 -1.9748
## 6    DCCS4     2     57.022  -7.103  -6.958  -6.993  -3.132 -2.9883
## 7    DCCS5     2     58.831  -8.026  -7.780  -7.989  -4.011 -3.9568
## 8     SC10     2     32.146  -6.199  -5.727  -5.995  -1.038 -0.9610
## 9     SC11     2     16.966  -6.044  -5.543  -5.994  -1.038 -0.9680
## 10    SC1B     2     62.896  -4.187  -3.911  -4.132  -3.473 -3.4140
## 11    SC2A     2     61.923  -4.880  -4.777  -4.827  -3.520 -3.4360
## 12    SC3A     2     61.733  -5.766  -5.467  -5.516  -3.565 -3.4320
## 13    SC4A     2     60.848  -7.699  -7.525  -7.588  -6.928 -6.7470
## 14    SC5A     2     61.339  -9.078  -8.651  -8.970  -6.938 -6.8880
## 15    SC6A     2     67.914 -10.397  -9.534 -10.329  -6.971 -6.8860
## 16    SC7A     2     65.968  -6.645  -6.447  -6.536  -5.203 -5.1440
## 17    SC8A     2     60.767  -9.449  -7.590  -7.952  -5.188 -5.1480
## 18    SC9B     2     60.937  -9.384  -8.139  -9.311  -5.203 -5.1370
##    S.L.AVG S.D.AVG   E.V.MIN E.V.MAX  E.A.MIN E.A.MAX T.AVG FD.MIN FD.MAX
## 1   -3.256  0.4457 -0.174330       0 -0.08441       0 293.0 0.7018 0.8354
## 2   -1.014  3.9473 -0.017568       0 -0.15550       0 297.5 0.9258 0.9422
## 3   -4.999  4.0097 -0.068824       0 -0.09518       0 294.7 0.9170 0.9823
## 4   -1.008  4.0019 -0.033969       0 -0.15064       0 297.9 0.9073 0.9387
## 5   -2.000  3.9803 -0.060718       0 -0.14177       0 297.1 0.9092 0.9661
## 6   -3.003  3.9901 -0.061275       0 -0.13528       0 296.7 0.9312 0.9900
## 7   -4.000  3.9895 -0.069213       0 -0.14917       0 294.8 0.9043 0.9691
## 8   -1.003  4.9916 -0.006195       0 -0.01482       0 298.0 0.8373 0.8425
## 9   -1.025  4.9693 -0.021617       0 -0.04677       0 298.0 0.7813 0.7983
## 10  -3.439  0.6925 -0.243860       0 -0.09874       0 298.0 0.7286 0.9298
## 11  -3.459  1.3683 -0.225030       0 -0.11139       0 298.0 0.7445 0.9324
## 12  -3.454  2.0623 -0.241510       0 -0.13777       0 298.0 0.7291 0.9283
## 13  -6.894  0.6944 -0.222610       0 -0.09474       0 298.0 0.7439 0.9294
## 14  -6.916  2.0549 -0.190630       0 -0.09817       0 298.0 0.8167 0.9883
## 15  -6.912  3.4164 -0.188180       0 -0.12228       0 298.0 0.7874 0.9504
## 16  -5.173  1.3636 -0.227880       0 -0.10278       0 298.0 0.7706 0.9678
## 17  -5.167  2.7848 -0.216170       0 -0.13914       0 298.0 0.7461 0.9261
## 18  -5.165  4.1463 -0.212080       0 -0.16152       0 298.0 0.7791 0.9631
##    W.AVG   ER.V.MIN  ER.V.MAX   ER.A.MIN  ER.A.MAX
## 1   2.40 -1.064e-06 0.000e+00 -5.177e-07 0.000e+00
## 2   1.66 -1.208e-06 4.225e-09 -1.131e-05 0.000e+00
## 3   1.49 -4.494e-06 7.194e-09 -4.622e-06 7.000e-06
## 4   1.77 -7.282e-06 1.038e-09 -1.510e-05 0.000e+00
## 5   1.63 -2.617e-06 0.000e+00 -3.613e-06 0.000e+00
## 6   1.59 -1.827e-06 5.523e-08 -2.597e-06 0.000e+00
## 7   1.55 -2.395e-06 3.822e-09 -2.329e-06 0.000e+00
## 8   0.00 -1.986e-08 0.000e+00 -6.720e-08 0.000e+00
## 9   0.00 -4.492e-06 0.000e+00 -1.512e-05 0.000e+00
## 10  2.34 -1.487e-05 0.000e+00 -7.015e-06 0.000e+00
## 11  2.25 -1.119e-05 0.000e+00 -6.524e-06 0.000e+00
## 12  2.21 -1.406e-05 0.000e+00 -9.305e-06 0.000e+00
## 13  2.27 -2.178e-05 2.778e-09 -1.050e-05 1.389e-09
## 14  2.52 -1.354e-05 0.000e+00 -7.716e-06 0.000e+00
## 15  2.19 -1.220e-05 0.000e+00 -1.060e-05 0.000e+00
## 16  2.33 -1.509e-05 2.556e-08 -8.127e-06 0.000e+00
## 17  2.29 -1.355e-05 6.805e-09 -9.277e-06 0.000e+00
## 18  2.33 -1.649e-05 5.556e-09 -1.308e-05 0.000e+00
\end{verbatim}
\end{kframe}
\end{knitrout}

\newpage
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlcom{###########################################################################}
\hlcom{# SOLVE FOR THE STRAINS USING CALLAHAN'S MODEL}
\hlcom{# TEST SC1B}
\hlcom{###########################################################################}

\hlcom{# ==== "events" function, for specifying step functions ====}
\hlcom{# ---- SETS STRAINS AND RATES = 0 AT TIME == 0 ----}
\hlstd{eventfun} \hlkwb{<-} \hlkwa{function}\hlstd{(}\hlkwc{Time}\hlstd{,} \hlkwc{State}\hlstd{,} \hlkwc{Parm}\hlstd{)\{}
  \hlkwd{with} \hlstd{(}\hlkwd{as.list}\hlstd{(State),\{}

    \hlcom{# ---- if time == 0, derivative = 0 ----}
    \hlstd{DZ} \hlkwb{<-} \hlkwd{ifelse}\hlstd{(}\hlkwd{c}\hlstd{(Time} \hlopt{==} \hlnum{0}\hlstd{, Time} \hlopt{==} \hlnum{0}\hlstd{, Time} \hlopt{==} \hlnum{0}\hlstd{), \{}\hlkwd{c}\hlstd{(}\hlnum{0}\hlstd{,} \hlnum{0}\hlstd{,} \hlnum{0}\hlstd{)\}, \{DZ\})}

    \hlkwd{return}\hlstd{(DZ)}
  \hlstd{\})}
\hlstd{\}}

\hlcom{# ==== DIFFERENTIAL EQUATION ====}
\hlstd{STRAINS.02} \hlkwb{<-} \hlkwa{function}\hlstd{(}\hlkwc{Time}\hlstd{,} \hlkwc{State}\hlstd{,} \hlkwc{Parm}\hlstd{)\{}
  \hlkwd{with}\hlstd{(}\hlkwd{as.list}\hlstd{(}\hlkwd{c}\hlstd{(State, Parm)),\{}
    \hlcom{# function for calculating axial and lateral strain rates}
    \hlcom{# Input must be in vector or matrix form, no data frames}
    \hlcom{# Eqns. referenced from:  SAND97-2601}
    \hlcom{# CPar: EAT0, ETA1, ETA2, NF, AA1, PP, NSP, R1, R3, R4, QSR}
    \hlcom{# FPar: KAP0, KAP1, KAP2, NK, DDT}
    \hlcom{# TestData:}

    \hlcom{# ============= parameters hard coded into function directly ========}
    \hlcom{# browser()}
    \hlstd{KAP0} \hlkwb{<-} \hlnum{10.119}
    \hlstd{KAP1} \hlkwb{<-} \hlnum{1.005}
    \hlstd{DDT}  \hlkwb{<-} \hlnum{0.896}
    \hlstd{NK}   \hlkwb{<-} \hlnum{1.331}
    \hlstd{KAP2} \hlkwb{<-} \hlnum{1}

    \hlstd{ETA0}  \hlkwb{<-} \hlnum{0.102854}        \hlcom{# -}
    \hlstd{ETA1}  \hlkwb{<-} \hlnum{3.9387}          \hlcom{# -}
    \hlstd{ETA2}   \hlkwb{<-} \hlnum{1}               \hlcom{# constant -}
    \hlstd{NF}          \hlkwb{<-} \hlnum{3.5122}          \hlcom{# -}
    \hlstd{AA1}         \hlkwb{<-} \hlnum{0.3147}          \hlcom{# -}
    \hlstd{PP}          \hlkwb{<-} \hlnum{1.6332}          \hlcom{# -}
    \hlstd{NSP}         \hlkwb{<-} \hlnum{0.557621}        \hlcom{# -}
    \hlstd{R1}          \hlkwb{<-} \hlnum{1.041} \hlopt{*} \hlnum{10} \hlopt{^ -}\hlnum{6} \hlcom{# [K/(MPa-sec)]}
    \hlstd{R3}          \hlkwb{<-} \hlnum{15.1281}         \hlcom{# -}
    \hlstd{R4}          \hlkwb{<-} \hlnum{0.1677765}       \hlcom{# -}
    \hlstd{QSR}         \hlkwb{<-} \hlnum{1077.46}         \hlcom{# [K]}

    \hlcom{# ---- Munson-Dawson Creep Parameters (17) ----}
    \hlstd{A1}          \hlkwb{<-} \hlnum{8.386e22}
    \hlstd{A2}          \hlkwb{<-} \hlnum{9.672e12}
    \hlstd{Q1R}         \hlkwb{<-} \hlnum{12581}
    \hlstd{Q2R}         \hlkwb{<-} \hlnum{5033}
    \hlstd{N1}          \hlkwb{<-} \hlnum{5.5}
    \hlstd{N2}          \hlkwb{<-} \hlnum{5.0}
    \hlstd{B1}          \hlkwb{<-} \hlnum{6.0856e6}
    \hlstd{B2}          \hlkwb{<-} \hlnum{3.034e-2}
    \hlstd{Q}           \hlkwb{<-} \hlnum{5335}
    \hlstd{S0}          \hlkwb{<-} \hlnum{20.57}
    \hlstd{M}           \hlkwb{<-} \hlnum{3}
    \hlstd{K0}          \hlkwb{<-} \hlnum{6.275e5}
    \hlstd{C}           \hlkwb{<-} \hlnum{9.198e-3}
    \hlstd{ALPHA} \hlkwb{<-} \hlopt{-}\hlnum{17.37}
    \hlstd{BETA}        \hlkwb{<-} \hlopt{-}\hlnum{7.738}
    \hlstd{DELTA} \hlkwb{<-} \hlnum{0.58}
    \hlstd{MU}          \hlkwb{<-} \hlnum{12400}

    \hlcom{# ---- fitting assumptions ----}
    \hlstd{RHOIS} \hlkwb{<-} \hlnum{2160.0}  \hlcom{# ASSUMED IN SITU SALT DENSITY}

    \hlcom{# ---- interpolated input variables ----}
    \hlstd{TIME} \hlkwb{<-} \hlkwd{time.interp}\hlstd{(Time)}
    \hlcom{# browser()}
    \hlstd{TEMP} \hlkwb{<-} \hlkwd{temp.interp}\hlstd{(Time)}
    \hlstd{AS}   \hlkwb{<-} \hlkwd{as.interp}\hlstd{(Time)}
    \hlstd{LS}   \hlkwb{<-} \hlkwd{ls.interp}\hlstd{(Time)}
    \hlstd{D}    \hlkwb{<-} \hlkwd{d.interp}\hlstd{(Time)}

    \hlcom{# ---- calculate variables ----}
    \hlstd{MS}  \hlkwb{<-} \hlstd{(}\hlnum{2.0} \hlopt{*} \hlstd{LS} \hlopt{+} \hlstd{AS)} \hlopt{/} \hlnum{3}  \hlcom{# MEAN STRESS}
    \hlstd{DS}  \hlkwb{<-} \hlstd{LS} \hlopt{-} \hlstd{AS}                                    \hlcom{# STRESS DIFFERENCE}
    \hlcom{#   ELC	<- (EVC - EAC) / 2		  # CREEP TRUE LATERAL STRAIN}
    \hlstd{D0}  \hlkwb{<-} \hlnum{1382.4} \hlopt{/} \hlstd{RHOIS}                         \hlcom{# EMPLACED FRACTIONAL DENSITY (0.64 FRAC DENSITY)}
    \hlstd{DI}  \hlkwb{<-} \hlstd{RHOI} \hlopt{/} \hlstd{RHOIS}                     \hlcom{# FRACTIONAL DENSITY at the start of creep}

    \hlcom{# ==== this portion has been moved to lambda <- function() =====}
    \hlcom{#WT1 <- DT / NTIME	  # WEIGHTING FUNCTION FOR CREEP CONSOLIDATION PARAMETERS}
    \hlcom{#WT 	<- 1					  # WEIGHTING FUNCTION FOR FLOW PARAMETERS}
    \hlcom{# ==============================================================}
    \hlcom{# integral of Eqn 2-27, (initial values)}

    \hlcom{# ==== define the differential equation ====}
    \hlcom{# browser()}
    \hlstd{VOL}         \hlkwb{<-} \hlstd{Z1} \hlopt{+} \hlnum{2}\hlopt{*}\hlstd{Z2}                        \hlcom{# TRUE VOLUMETRIC STRAIN}
    \hlstd{VOLT}        \hlkwb{<-} \hlstd{VOL} \hlopt{+} \hlkwd{log}\hlstd{(D0}\hlopt{/}\hlstd{DI)}     \hlcom{# VOLUMETRIC STRAIN + INITIAL TRUE STRAIN ESTIMATE}
    \hlstd{DEN}         \hlkwb{<-} \hlstd{DI}\hlopt{/}\hlkwd{exp}\hlstd{(VOL)}                  \hlcom{# CURRENT FRACTIONAL DENSITY}

    \hlcom{#     ifelse(D >= 1,\{}
    \hlcom{#       MD <- 0  # if fractional density is 1, disclocation creep = 0}
    \hlcom{#       SP <- 0\},# if fractional density is 1, pressure solutioning = 0}
    \hlcom{#     \{VAR <- ifelse(DEN <= DDT, DDT, DEN) # DEFINE DENSITY CEILING ISH}

    \hlstd{VAR} \hlkwb{<-} \hlkwd{ifelse}\hlstd{(DEN} \hlopt{<=} \hlstd{DDT, DDT, DEN)} \hlcom{# DEFINE DENSITY floor ISH}
    \hlcom{# ==== DEBUG ====}
    \hlstd{DEBUG.VAR} \hlkwb{<-} \hlkwd{ifelse}\hlstd{(DEN} \hlopt{<=} \hlstd{DDT,} \hlnum{1}\hlstd{,} \hlopt{-}\hlnum{1}\hlstd{)}

    \hlcom{# ---- Equivalent Stress ----}
    \hlstd{OMEGAA}      \hlkwb{<-} \hlstd{((}\hlnum{1} \hlopt{-} \hlstd{DEN)} \hlopt{*} \hlstd{NF} \hlopt{/} \hlstd{(}\hlnum{1} \hlopt{-} \hlstd{(}\hlnum{1} \hlopt{-} \hlstd{DEN)}\hlopt{^}\hlstd{(}\hlnum{1}\hlopt{/}\hlstd{NF))}\hlopt{^}\hlstd{NF)}\hlopt{^}\hlstd{(}\hlnum{2}\hlopt{/}\hlstd{(NF} \hlopt{+} \hlnum{1}\hlstd{))}
    \hlstd{OMEGAK}      \hlkwb{<-} \hlstd{((}\hlnum{1} \hlopt{-} \hlstd{VAR)} \hlopt{*} \hlstd{NK} \hlopt{/} \hlstd{(}\hlnum{1} \hlopt{-} \hlstd{(}\hlnum{1} \hlopt{-} \hlstd{VAR)}\hlopt{^}\hlstd{(}\hlnum{1}\hlopt{/}\hlstd{NK))}\hlopt{^}\hlstd{NK)}\hlopt{^}\hlstd{(}\hlnum{2}\hlopt{/}\hlstd{(NK} \hlopt{+} \hlnum{1}\hlstd{))}
    \hlstd{ETA}         \hlkwb{<-} \hlstd{ETA0} \hlopt{*} \hlstd{OMEGAA}\hlopt{^}\hlstd{ETA1}
    \hlstd{KAP}         \hlkwb{<-} \hlstd{KAP0} \hlopt{*} \hlstd{OMEGAK}\hlopt{^}\hlstd{KAP1}
    \hlstd{TERMA}       \hlkwb{<-} \hlstd{((}\hlnum{2} \hlopt{-} \hlstd{DEN)}\hlopt{/}\hlstd{DEN)}\hlopt{^}\hlstd{((}\hlnum{2} \hlopt{*} \hlstd{NF)}\hlopt{/}\hlstd{(NF} \hlopt{+} \hlnum{1}\hlstd{))}
    \hlstd{TERMK}       \hlkwb{<-} \hlstd{((}\hlnum{2} \hlopt{-} \hlstd{DEN)}\hlopt{/}\hlstd{DEN)}\hlopt{^}\hlstd{((}\hlnum{2} \hlopt{*} \hlstd{NK)}\hlopt{/}\hlstd{(NK} \hlopt{+} \hlnum{1}\hlstd{))}

    \hlcom{# ---- Eqn. 2-3 (SAND97-2601) ----}
    \hlcom{# Equivalent stress measure for Disl. Creep and Press Sol'ing}
    \hlstd{SEQF}        \hlkwb{<-} \hlkwd{sqrt}\hlstd{(ETA} \hlopt{*} \hlstd{MS}\hlopt{^}\hlnum{2} \hlopt{+} \hlstd{ETA2} \hlopt{*} \hlstd{TERMA} \hlopt{*} \hlstd{DS}\hlopt{^}\hlnum{2}\hlstd{)}
    \hlcom{# Equivalent stress measure for Flow Potential}
    \hlstd{SEQ}         \hlkwb{<-} \hlkwd{sqrt}\hlstd{(KAP} \hlopt{*} \hlstd{MS}\hlopt{^}\hlnum{2} \hlopt{+} \hlstd{KAP2} \hlopt{*} \hlstd{TERMK} \hlopt{*} \hlstd{DS}\hlopt{^}\hlnum{2}\hlstd{)}

    \hlcom{# ---- Eqn. 2-17 (SAND97-2601) ----}
    \hlstd{ALPHA2}      \hlkwb{<-} \hlstd{KAP} \hlopt{*} \hlstd{MS} \hlopt{/} \hlnum{3}
    \hlstd{BETA2}       \hlkwb{<-} \hlstd{KAP2} \hlopt{*} \hlstd{TERMK} \hlopt{*} \hlstd{DS}

    \hlcom{# ---- Eqn. 2-20, WithOUT dislocation creep and pressure solutioning ----}
    \hlstd{F2A} \hlkwb{<-}      \hlstd{(ALPHA2} \hlopt{-} \hlstd{BETA2)}\hlopt{/}\hlstd{SEQ}        \hlcom{# fit to axial strains}
    \hlstd{F2L} \hlkwb{<-}      \hlstd{(ALPHA2} \hlopt{+} \hlnum{0.5} \hlopt{*} \hlstd{BETA2)}\hlopt{/}\hlstd{SEQ}  \hlcom{# fit to lateral strains}
    \hlstd{F2V} \hlkwb{<-}  \hlnum{3} \hlopt{*} \hlstd{ALPHA2} \hlopt{/} \hlstd{SEQ}            \hlcom{# fit to volumetric strains}

    \hlcom{# ==== START: equivalent inelastic strain rate form for dislocation creep ====}

    \hlcom{# ---- Steady State Strain Rate Calc ----}
    \hlstd{ES1} \hlkwb{<-} \hlstd{A1} \hlopt{*} \hlstd{(SEQF} \hlopt{/} \hlstd{MU)}\hlopt{^}\hlstd{N1} \hlopt{*} \hlkwd{exp}\hlstd{(}\hlopt{-}\hlstd{Q1R}\hlopt{/}\hlstd{TEMP)} \hlcom{# Dislocation climb - Eqn. 2-30}
    \hlstd{ES2} \hlkwb{<-} \hlstd{A2} \hlopt{*} \hlstd{(SEQF} \hlopt{/} \hlstd{MU)}\hlopt{^}\hlstd{N2} \hlopt{*} \hlkwd{exp}\hlstd{(}\hlopt{-}\hlstd{Q2R}\hlopt{/}\hlstd{TEMP)} \hlcom{# Undefined Mechanism - Eqn. 2-31}

    \hlcom{# Slip - Eqn. 2-32 (SAND98-2601)}
    \hlstd{H}   \hlkwb{<-} \hlstd{SEQF} \hlopt{-} \hlstd{S0} \hlcom{# HEAVISIDE FUNCTION}
    \hlstd{ARG} \hlkwb{<-} \hlstd{Q} \hlopt{*} \hlstd{(SEQF} \hlopt{-} \hlstd{S0)} \hlopt{/} \hlstd{MU}
    \hlstd{ES3} \hlkwb{<-} \hlkwd{ifelse}\hlstd{(H} \hlopt{>=} \hlnum{0}\hlstd{,} \hlnum{0.5} \hlopt{*} \hlstd{(B1} \hlopt{*} \hlkwd{exp}\hlstd{(}\hlopt{-}\hlstd{Q1R} \hlopt{/} \hlstd{TEMP)} \hlopt{+} \hlstd{B2} \hlopt{*} \hlkwd{exp}\hlstd{(}\hlopt{-}\hlstd{Q2R} \hlopt{/} \hlstd{TEMP))} \hlopt{*}
                    \hlstd{(}\hlkwd{exp}\hlstd{(ARG)} \hlopt{-} \hlkwd{exp}\hlstd{(}\hlopt{-}\hlstd{ARG)),}\hlnum{0}\hlstd{)}
    \hlcom{# ==== DEBUG ====}
    \hlstd{DEBUG.ES3} \hlkwb{<-} \hlkwd{ifelse}\hlstd{(H} \hlopt{>=}\hlnum{0}\hlstd{,} \hlnum{1}\hlstd{,} \hlopt{-}\hlnum{1}\hlstd{)}

    \hlstd{ESS} \hlkwb{=} \hlstd{ES1} \hlopt{+} \hlstd{ES2} \hlopt{+} \hlstd{ES3} \hlcom{# Steady-state strain rate, Eqn. 2-29 (SAND97-2601)}

    \hlcom{# ---- EVALUATE TRANSIENT FUNCTION, 3 branches: work hardening, equilibrium, recovery}
    \hlstd{EFT}  \hlkwb{<-} \hlstd{K0} \hlopt{*} \hlkwd{exp}\hlstd{(C} \hlopt{*} \hlstd{TEMP)} \hlopt{*} \hlstd{(SEQF} \hlopt{/} \hlstd{MU)} \hlopt{^} \hlstd{M}  \hlcom{# Transient Strain Limit, Eqn. 2-28}
    \hlstd{BIGD} \hlkwb{<-} \hlstd{ALPHA} \hlopt{+} \hlstd{BETA} \hlopt{*} \hlkwd{log10}\hlstd{(SEQF} \hlopt{/} \hlstd{MU)}       \hlcom{# Work-Hardening parameter, Eqn 2-28}

    \hlstd{FU} \hlkwb{<-} \hlkwd{ifelse}\hlstd{(Z3} \hlopt{==} \hlstd{EFT,} \hlnum{1}\hlstd{,} \hlkwd{ifelse}\hlstd{(Z3} \hlopt{<} \hlstd{EFT,} \hlkwd{exp}\hlstd{(BIGD} \hlopt{*} \hlstd{(}\hlnum{1} \hlopt{-} \hlstd{Z3} \hlopt{/} \hlstd{EFT)} \hlopt{^} \hlnum{2}\hlstd{),}
                                      \hlkwd{exp}\hlstd{(}\hlopt{-}\hlstd{DELTA} \hlopt{*} \hlstd{(}\hlnum{1} \hlopt{-} \hlstd{Z3} \hlopt{/} \hlstd{EFT)} \hlopt{^} \hlnum{2}\hlstd{)))}

    \hlcom{# ==== DEBUG ====}
    \hlstd{DEBUG.FU} \hlkwb{<-} \hlkwd{ifelse}\hlstd{(Z3} \hlopt{==} \hlstd{EFT,} \hlnum{0}\hlstd{,} \hlkwd{ifelse}\hlstd{(Z3} \hlopt{<} \hlstd{EFT,} \hlopt{-}\hlnum{1}\hlstd{,} \hlnum{1}\hlstd{))}

    \hlstd{MD} \hlkwb{<-} \hlstd{FU} \hlopt{*} \hlstd{ESS}  \hlcom{# equivalent inelastic strain rate form for dislocation creep, Eqn 2-23}

    \hlcom{# ==== START: Equivalent Inelastic Strain Rate Form for Pressure Solutioning ====}
    \hlcom{# ---- Calculate initial volumetric strain - Based on spherical packing ----}
    \hlstd{CR} \hlkwb{<-} \hlkwd{abs}\hlstd{(}\hlkwd{exp}\hlstd{(VOLT)} \hlopt{-} \hlnum{1}\hlstd{)} \hlcom{# USES THE DEFINITION OF ENGINEERING STRAIN}

    \hlcom{# ---- Determine functional form - either large or small strains, Eqn 2-34 ----}
    \hlstd{GAMMA} \hlkwb{<-} \hlkwd{ifelse}\hlstd{(CR} \hlopt{<=} \hlnum{0.15}\hlstd{,} \hlnum{1}\hlstd{, (}\hlkwd{abs}\hlstd{((D0} \hlopt{-} \hlkwd{exp}\hlstd{(VOLT))} \hlopt{/} \hlstd{((}\hlnum{1} \hlopt{-} \hlstd{D0)} \hlopt{*} \hlkwd{exp}\hlstd{(VOLT))))} \hlopt{^} \hlstd{NSP)}
    \hlcom{# Small Strains (Vol Strain > - 15%)}
    \hlcom{# Large Strains (Vol Strain < - 15%)}
    \hlcom{# ==== DEBUG ====}
    \hlstd{DEBUG.GAMMA} \hlkwb{<-} \hlkwd{ifelse}\hlstd{(CR} \hlopt{<=} \hlnum{0.15}\hlstd{,} \hlnum{1}\hlstd{,}\hlopt{-}\hlnum{1}\hlstd{)}

    \hlcom{# ---- component of eqn 2-35 ---}
    \hlstd{X3} \hlkwb{<-} \hlkwd{exp}\hlstd{((R3} \hlopt{-} \hlnum{1}\hlstd{)} \hlopt{*} \hlstd{VOLT)} \hlopt{/} \hlstd{(}\hlkwd{abs}\hlstd{(}\hlnum{1} \hlopt{-} \hlkwd{exp}\hlstd{(VOLT)))} \hlopt{^} \hlstd{R4}

    \hlcom{# ---- determine value of moisture function (w) ----}
    \hlstd{M2} \hlkwb{<-} \hlkwd{ifelse} \hlstd{(W} \hlopt{==} \hlnum{0}\hlstd{,} \hlnum{0}\hlstd{, W} \hlopt{^} \hlstd{AA1)}

    \hlcom{# ---- Equivalent Inelastic Strain Rate Form for Pressure Solutioning, Eqn 2-35}
    \hlstd{G2} \hlkwb{<-} \hlnum{1} \hlopt{/} \hlstd{DD} \hlopt{^} \hlstd{PP} \hlcom{# calculate grain size function}
    \hlstd{T2} \hlkwb{<-} \hlkwd{exp}\hlstd{(}\hlopt{-}\hlstd{QSR} \hlopt{/} \hlstd{TEMP)} \hlopt{/} \hlstd{TEMP}
    \hlstd{SP} \hlkwb{<-} \hlstd{R1} \hlopt{*} \hlstd{M2} \hlopt{*} \hlstd{G2} \hlopt{*} \hlstd{T2} \hlopt{*} \hlstd{X3} \hlopt{*} \hlstd{GAMMA} \hlopt{*} \hlstd{SEQF} \hlcom{#\})}

    \hlstd{DZ1} \hlkwb{<-} \hlstd{(MD} \hlopt{+} \hlstd{SP)} \hlopt{*} \hlstd{F2A} \hlcom{# derivative: axial strain rate}
    \hlstd{DZ2} \hlkwb{<-} \hlstd{(MD} \hlopt{+} \hlstd{SP)} \hlopt{*} \hlstd{F2L} \hlcom{# derivative: lateral strain rate}
    \hlstd{DZ3} \hlkwb{<-} \hlstd{(FU} \hlopt{-} \hlnum{1}\hlstd{)} \hlopt{*} \hlstd{ESS}  \hlcom{# derivative of internal variable "xi"}
    \hlcom{#     browser()}
    \hlstd{DZ} \hlkwb{<-} \hlkwd{list}\hlstd{(}\hlkwd{c}\hlstd{(DZ1, DZ2, DZ3), MD, FU, ESS, ES1, ES2, ES3, SP, DZ1, DZ2,}
               \hlstd{DZ3, F2A, F2L, EFT, SEQ, SEQF, BIGD, DEBUG.GAMMA,}
               \hlstd{DEBUG.ES3, AS, LS, OMEGAA, OMEGAK,VAR, DEN)}

    \hlkwd{return}\hlstd{(DZ)}
  \hlstd{\})}
\hlstd{\}}
\end{alltt}
\end{kframe}
\end{knitrout}

\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{PAR.TEST} \hlkwb{<-} \hlstd{DATA.INP[}\hlkwd{which}\hlstd{(DATA.INP}\hlopt{$}\hlstd{ITEST} \hlopt{==} \hlstr{"SC1B"}\hlstd{),]} \hlcom{# SUBSET OF DATA FOR ANALYSIS}
\hlcom{# debug.out <- paste(CurrentDirectory,"debug_SC1B.csv",sep = "/")}
\hlcom{# write.table(ODE.DT,file = debug.out, sep = ",")}

\hlcom{# ---- linear interpolation functions to be called in "strain_Rates.01" ----}
\hlstd{time.interp} \hlkwb{<-} \hlkwd{approxfun}\hlstd{(}\hlkwc{x} \hlstd{= PAR.TEST}\hlopt{$}\hlstd{TIME,} \hlkwc{y} \hlstd{= PAR.TEST}\hlopt{$}\hlstd{TIME)}
\hlstd{temp.interp} \hlkwb{<-} \hlkwd{approxfun}\hlstd{(}\hlkwc{x} \hlstd{= PAR.TEST}\hlopt{$}\hlstd{TIME,} \hlkwc{y} \hlstd{= PAR.TEST}\hlopt{$}\hlstd{TEMP)}
\hlcom{# as.interp   <- approxfun(x = PAR.TEST$TIME, y = PAR.TEST$AS)}
\hlcom{# ls.interp   <- approxfun(x = PAR.TEST$TIME, y = PAR.TEST$LS)}
\hlstd{as.interp}   \hlkwb{<-} \hlkwd{approxfun}\hlstd{(}\hlkwc{x} \hlstd{= DATA.BEAN}\hlopt{$}\hlstd{TIME,} \hlkwc{y} \hlstd{= DATA.BEAN}\hlopt{$}\hlstd{STRESS_YY} \hlopt{/} \hlnum{10}\hlopt{^}\hlnum{6}\hlstd{)}
\hlstd{ls.interp}   \hlkwb{<-} \hlkwd{approxfun}\hlstd{(}\hlkwc{x} \hlstd{= DATA.BEAN}\hlopt{$}\hlstd{TIME,} \hlkwc{y} \hlstd{= DATA.BEAN}\hlopt{$}\hlstd{STRESS_XX} \hlopt{/} \hlnum{10}\hlopt{^}\hlnum{6}\hlstd{)}

\hlstd{d.interp}    \hlkwb{<-} \hlkwd{approxfun}\hlstd{(}\hlkwc{x} \hlstd{= PAR.TEST}\hlopt{$}\hlstd{TIME,} \hlkwc{y} \hlstd{= PAR.TEST}\hlopt{$}\hlstd{D)}

\hlstd{RHOI}   \hlkwb{<-} \hlkwd{as.numeric}\hlstd{(PAR.TEST}\hlopt{$}\hlstd{RHOI[}\hlnum{1}\hlstd{])}  \hlcom{# DENSITY AT THE START OF CREEP}
\hlstd{DD}              \hlkwb{<-} \hlkwd{as.numeric}\hlstd{(PAR.TEST}\hlopt{$}\hlstd{DD[}\hlnum{1}\hlstd{])}   \hlcom{# AVERAGE GRAIN SIZE [MM]}
\hlstd{W}               \hlkwb{<-} \hlkwd{as.numeric}\hlstd{(PAR.TEST}\hlopt{$}\hlstd{W[}\hlnum{1}\hlstd{])}    \hlcom{# WATER CONENT BY PERCENT WEIGHT}

\hlstd{PARM} \hlkwb{<-} \hlkwd{c}\hlstd{(}\hlkwc{RHOI} \hlstd{= RHOI,} \hlkwc{DD} \hlstd{= DD,} \hlkwc{W} \hlstd{= W)} \hlcom{# CONSTANT TEST SPECIFIC PARAMETERS}

\hlcom{# ---- intial values for state variables ----}
\hlstd{Z1}      \hlkwb{<-} \hlnum{0} \hlcom{# Predicted axial strain (initial values)}
\hlstd{Z2}      \hlkwb{<-} \hlnum{0} \hlcom{# Predicted lateral strain (initial values)}
\hlstd{Z3}      \hlkwb{<-} \hlnum{0} \hlcom{# internal variable "xi" for the transient function (FU)}
\hlcom{# integral of Eqn 2-27, (initial values)}

\hlstd{IC} \hlkwb{<-} \hlstd{(}\hlkwd{c}\hlstd{(}\hlkwc{Z1} \hlstd{= Z1,} \hlkwc{Z2} \hlstd{= Z2,} \hlkwc{Z3} \hlstd{= Z3))} \hlcom{# array of initial values}

\hlstd{TIME} \hlkwb{<-} \hlstd{DATA.BEAN}\hlopt{$}\hlstd{TIME}

\hlcom{# ---- function for Predicting the Creep Strain(E) Rates ----}
\hlstd{P.CER} \hlkwb{<-} \hlkwd{ode}\hlstd{(}\hlkwc{func} \hlstd{= STRAINS.02,} \hlkwc{parms} \hlstd{= PARM,} \hlkwc{y} \hlstd{= IC,}
             \hlkwc{times} \hlstd{= TIME,} \hlkwc{verbose} \hlstd{=} \hlnum{TRUE}\hlstd{)}\hlcom{#, events = list(func = eventfun, time = 0),}
\end{alltt}
\begin{verbatim}
## 
## -------------------- 
## Time settings 
## --------------------
##  
##   Normal computation of output values of y(t) at t = TOUT 
## 
## -------------------- 
## Integration settings 
## --------------------
##  
##   Model function an R-function:  
##   Jacobian not specified 
## 
## 
## --------------------
## lsoda return code
## --------------------
## 
##   return code (idid) =  2 
##   Integration was successful.
## 
## --------------------
## INTEGER values
## --------------------
## 
##   1 The return code : 2 
##   2 The number of steps taken for the problem so far: 116 
##   3 The number of function evaluations for the problem so far: 238 
##   5 The method order last used (successfully): 4 
##   6 The order of the method to be attempted on the next step: 4 
##   7 If return flag =-4,-5: the largest component in error vector 0 
##   8 The length of the real work array actually required: 68 
##   9 The length of the integer work array actually required: 23 
##  14 The number of Jacobian evaluations and LU decompositions so far: 0 
##  15 The method indicator for the last succesful step,
##            1=adams (nonstiff), 2= bdf (stiff): 1 
##  16 The current method indicator to be attempted on the next step,
##            1=adams (nonstiff), 2= bdf (stiff): 1 
##  
## --------------------
## RSTATE values
## --------------------
## 
##   1 The step size in t last used (successfully): 252000 
##   2 The step size to be attempted on the next step: 252000 
##   3 The current value of the independent variable which the solver has reached: 5548000 
##   4 Tolerance scale factor > 1.0 computed when requesting too much accuracy: 0 
##   5 The value of t at the time of the last method switch, if any: 0 
## 
\end{verbatim}
\end{kframe}
\end{knitrout}


\end{document}
